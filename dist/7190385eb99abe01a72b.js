(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{104:function(t,a,r){"use strict";var e=r(74);r.n(e).a},115:function(t,a,r){"use strict";r.r(a);var e=function(){var t=this,a=t.$createElement,r=t._self._c||a;return r("div",[r("div",{staticClass:"works"},[r("div",{staticClass:"change-block change-block--works"},[r("div",{staticClass:"change-block-title"},[t._v("Добавление работы")]),r("form",{staticClass:"works__field"},[r("div",{staticClass:"works__drag"},[t.filePreview?r("img",{attrs:{src:t.filePreview}}):t._e(),r("input",{ref:"fileUpload",staticStyle:{display:"none"},attrs:{type:"file"},on:{change:t.handleFile}}),r("div",{staticClass:"works__drag-desc"},[t._v("Загрузите изображение")]),r("button",{staticClass:"load",attrs:{type:"button"},on:{click:function(a){return t.$refs.fileUpload.click()}}},[t._v("Загрузить")])]),r("div",{staticClass:"works__add"},[r("form",{staticClass:"works__form",on:{submit:function(a){return a.preventDefault(),t.submitForm(a)}}},[r("label",{staticClass:"input__subtext",attrs:{for:"works-name-id"}},[t._v("Название"),t.isError?r("span",{staticClass:"error"},[t._v(t._s(this.validation.firstError("formData.name")))]):t._e()]),r("input",{directives:[{name:"model",rawName:"v-model",value:t.formData.name,expression:"formData.name"}],staticClass:"input__form",attrs:{id:"works-name-id",type:"text",name:"name"},domProps:{value:t.formData.name},on:{input:function(a){a.target.composing||t.$set(t.formData,"name",a.target.value)}}}),r("label",{staticClass:"input__subtext",attrs:{for:"works-link-id"}},[t._v("Ссылка"),t.isError?r("span",{staticClass:"error"},[t._v(t._s(this.validation.firstError("formData.link")))]):t._e()]),r("input",{directives:[{name:"model",rawName:"v-model",value:t.formData.link,expression:"formData.link"}],staticClass:"input__form",attrs:{id:"works-link-id",type:"text",name:"link"},domProps:{value:t.formData.link},on:{input:function(a){a.target.composing||t.$set(t.formData,"link",a.target.value)}}}),r("label",{staticClass:"input__subtext",attrs:{for:"works-textarea-id"}},[t._v("Описание"),t.isError?r("span",{staticClass:"error"},[t._v(t._s(this.validation.firstError("formData.description")))]):t._e()]),r("textarea",{directives:[{name:"model",rawName:"v-model",value:t.formData.description,expression:"formData.description"}],staticClass:"input__textarea works-textarea",attrs:{id:"textarea-connect-id",name:"textarea"},domProps:{value:t.formData.description},on:{input:function(a){a.target.composing||t.$set(t.formData,"description",a.target.value)}}}),r("label",{staticClass:"input__subtext",attrs:{for:"works-tag-id"}},[t._v("Добавление тэга"),t.isError?r("span",{staticClass:"error"},[t._v(t._s(this.validation.firstError("formData.tags")))]):t._e()]),r("input",{directives:[{name:"model",rawName:"v-model",value:t.formData.tags,expression:"formData.tags"}],staticClass:"input__form",attrs:{id:"works-tag-id",type:"text",name:"tag"},domProps:{value:t.formData.tags},on:{input:function(a){a.target.composing||t.$set(t.formData,"tags",a.target.value)}}}),r("div",{staticClass:"block__buttons"},[r("button",{staticClass:"cancel",attrs:{type:"button"},on:{click:t.cancelCreateWorkBlock}},[t._v("Отмена")]),r("button",{staticClass:"load"},[t._v("Загрузить")])])])])])])]),r("div",{staticClass:"new-works"},[r("button",{staticClass:"load-big",on:{click:t.addNewWorkBlock}},[r("div",{staticClass:"load-big__icon-box"},[r("svg-icon",{attrs:{className:"load__icon",iconName:"remove"}})],1),r("div",{staticClass:"load__text"},[t._v("Добавить работу")])]),r("ul",{staticClass:"works-list"},t._l(t.works,(function(a){return r("li",{key:a.id,staticClass:"change-block change-block--work"},[r("work-edit",{attrs:{workItem:t.formData}})],1)})),0)])])};e._withStripped=!0;r(15);var o=r(10),s=r(72),i={data:function(){return{formData:{name:"",link:"",description:"",tags:[],photo:""},isError:!1,filePreview:"",works:[]}},components:{svgIcon:function(){return Promise.resolve().then(r.bind(null,15))},workEdit:function(){return r.e(10).then(r.bind(null,116))}},methods:{handleFile:function(t){var a=this,r=this.fileFromForm(t);this.formData.photo=r,this.renderFile(r).then((function(t){a.filePreview=t}))},fileFromForm:function(t){var a=t.target.files||t.dataTransfer.files;if(!a.length)throw new Error("Нет файла");return a[0]},renderFile:function(t){var a=new FileReader;return new Promise((function(r,e){try{a.readAsDataURL(t),a.onloadend=function(){r(a.result)}}catch(t){throw new Error("Ошибка при чтении файла")}}))},submitForm:function(){var t=this;s.a.post("/works",{title:this.formData.name,techs:this.formData.tags,photo:this.formData.photo,link:this.formData.link,description:this.formData.description}).then((function(t){console.log(t.data)})).catch((function(t){console.log(t.response.data)})),this.$validate().then((function(a){a?console.log("Send form here",a):(console.log("Validation error",a),t.isError=!0)}))},fetchWorks:function(){var t=this;s.a.get("/works/182").then((function(a){t.works=a.data}))},addNewWorkBlock:function(t){this.works.push(t)},createWorkBlock:function(){var t=this;s.a.post("/works",{title:this.formData.name,techs:this.formData.tags,photo:this.formData.photo,link:this.formData.link,description:this.formData.description}).then((function(a){t.works.unshift(a.data)}))},cancelCreateWorkBlock:function(){s.a.post("/works",{title:"",techs:"",photo:"",link:"",description:""})}},validators:{"formData.name":function(t){return o.Validator.value(t).required("Введите имя")},"formData.link":function(t){return o.Validator.value(t).required("Введите ссылку")},"formData.description":function(t){return o.Validator.value(t).required("Введите описание")},"formData.tags":function(t){return o.Validator.value(t).required("Введите тэги")},"formData.photo":function(t){return o.Validator.value(t).required("Загрузите изображение")}},created:function(){this.fetchWorks()}},n=(r(104),r(3)),l=Object(n.a)(i,e,[],!1,null,null,null);l.options.__file="src/admin/pages/works.vue";a.default=l.exports},72:function(t,a,r){"use strict";var e=r(73),o=r.n(e),s=localStorage.getItem("token");o.a.defaults.baseURL="https://webdev-api.loftschool.com",o.a.defaults.headers.Authorization="Bearer ".concat(s),o.a.interceptors.response.use((function(t){return t}),(function(t){var a=t.config;return t.response&&401===t.response.status?o.a.post("/refreshToken").then((function(t){var r=t.data.token;return localStorage.setItem("token",r),o.a.defaults.headers.Authorization="Bearer ".concat(r),a.headers.Authorization="Bearer ".concat(r),o()(a)})):Promise.reject(t)})),a.a=o.a},74:function(t,a,r){}}]);