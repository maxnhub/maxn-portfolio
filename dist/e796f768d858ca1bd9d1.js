(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{104:function(t,a,e){"use strict";var r=e(74);e.n(r).a},115:function(t,a,e){"use strict";e.r(a);var r=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",[e("div",{staticClass:"works"},[e("div",{staticClass:"change-block change-block--works"},[e("div",{staticClass:"change-block-title"},[t._v("Добавление работы")]),e("form",{staticClass:"works__field"},[e("div",{staticClass:"works__drag"},[t.filePreview?e("img",{attrs:{src:t.filePreview}}):t._e(),e("input",{ref:"fileUpload",staticStyle:{display:"none"},attrs:{type:"file"},on:{change:t.handleFile}}),e("div",{staticClass:"works__drag-desc"},[t._v("Загрузите изображение")]),e("button",{staticClass:"load",attrs:{type:"button"},on:{click:function(a){return t.$refs.fileUpload.click()}}},[t._v("Загрузить")])]),e("div",{staticClass:"works__add"},[e("form",{staticClass:"works__form",on:{submit:function(a){return a.preventDefault(),t.submitForm(a)}}},[e("label",{staticClass:"input__subtext",attrs:{for:"works-name-id"}},[t._v("Название"),t.isError?e("span",{staticClass:"error"},[t._v(t._s(this.validation.firstError("formData.title")))]):t._e()]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.formData.title,expression:"formData.title"}],staticClass:"input__form",attrs:{id:"works-name-id",type:"text",name:"name"},domProps:{value:t.formData.title},on:{input:function(a){a.target.composing||t.$set(t.formData,"title",a.target.value)}}}),e("label",{staticClass:"input__subtext",attrs:{for:"works-link-id"}},[t._v("Ссылка"),t.isError?e("span",{staticClass:"error"},[t._v(t._s(this.validation.firstError("formData.link")))]):t._e()]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.formData.link,expression:"formData.link"}],staticClass:"input__form",attrs:{id:"works-link-id",type:"text",name:"link"},domProps:{value:t.formData.link},on:{input:function(a){a.target.composing||t.$set(t.formData,"link",a.target.value)}}}),e("label",{staticClass:"input__subtext",attrs:{for:"works-textarea-id"}},[t._v("Описание"),t.isError?e("span",{staticClass:"error"},[t._v(t._s(this.validation.firstError("formData.description")))]):t._e()]),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.formData.description,expression:"formData.description"}],staticClass:"input__textarea works-textarea",attrs:{id:"textarea-connect-id",name:"textarea"},domProps:{value:t.formData.description},on:{input:function(a){a.target.composing||t.$set(t.formData,"description",a.target.value)}}}),e("label",{staticClass:"input__subtext",attrs:{for:"works-tag-id"}},[t._v("Добавление тэга"),t.isError?e("span",{staticClass:"error"},[t._v(t._s(this.validation.firstError("formData.techs")))]):t._e()]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.formData.techs,expression:"formData.techs"}],staticClass:"input__form",attrs:{id:"works-tag-id",type:"text",name:"tag"},domProps:{value:t.formData.techs},on:{input:function(a){a.target.composing||t.$set(t.formData,"techs",a.target.value)}}}),e("div",{staticClass:"block__buttons"},[e("button",{staticClass:"cancel",attrs:{type:"button"},on:{click:t.cancelCreateWorkBlock}},[t._v("Отмена")]),e("button",{staticClass:"load"},[t._v("Загрузить")])])])])])])]),e("div",{staticClass:"new-works"},[e("ul",{staticClass:"works-list"},[e("button",{staticClass:"load-big",on:{click:t.addNewWorkBlock}},[e("div",{staticClass:"load-big__icon-box"},[e("svg-icon",{attrs:{className:"load__icon",iconName:"remove"}})],1),e("div",{staticClass:"load__text"},[t._v("Добавить работу  ")])]),t._l(t.works,(function(a){return e("li",{key:a.id,staticClass:"change-block change-block--work",attrs:{id:"change-block-work"}},[e("work-edit",{attrs:{workItem:t.formData}})],1)}))],2)])])};r._withStripped=!0;e(15);var o=e(10),s=e(72),i={data:function(){return{formData:{title:"",link:"",description:"",techs:[],photo:""},isError:!1,filePreview:"",works:[]}},components:{svgIcon:function(){return Promise.resolve().then(e.bind(null,15))},workEdit:function(){return e.e(10).then(e.bind(null,116))}},methods:{handleFile:function(t){var a=this,e=this.fileFromForm(t);this.formData.photo=e,this.renderFile(e).then((function(t){a.filePreview=t}))},fileFromForm:function(t){var a=t.target.files||t.dataTransfer.files;if(!a.length)throw new Error("Нет файла");return a[0]},renderFile:function(t){var a=new FileReader;return new Promise((function(e,r){try{a.readAsDataURL(t),a.onloadend=function(){e(a.result)}}catch(t){throw new Error("Ошибка при чтении файла")}}))},submitForm:function(){var t=this,a=new FormData;Object.keys(this.formData).forEach((function(e){a.append(e,t.formData[e])})),this.$validate().then((function(e){e?s.a.post("/works",a).then((function(a){t.works.unshift(a.data)})).catch((function(t){console.log(t.response.data)})):(console.log("Validation error",e),t.isError=!0)}))},fetchWorks:function(){var t=this;s.a.get("/works/182").then((function(a){t.works=a.data}))},addNewWorkBlock:function(t){this.works.push(t)},createWorkBlock:function(){var t=this;s.a.post("/works",{title:this.formData.title,techs:this.formData.techs,photo:this.formData.photo,link:this.formData.link,description:this.formData.description}).then((function(a){t.works.unshift(a.data)}))},cancelCreateWorkBlock:function(){s.a.post("/works",{title:"",techs:"",photo:"",link:"",description:""})}},validators:{"formData.title":function(t){return o.Validator.value(t).required("Введите имя")},"formData.link":function(t){return o.Validator.value(t).required("Введите ссылку")},"formData.description":function(t){return o.Validator.value(t).required("Введите описание")},"formData.techs":function(t){return o.Validator.value(t).required("Введите тэги")},"formData.photo":function(t){return o.Validator.value(t).required("Загрузите изображение")}},created:function(){this.fetchWorks()}},n=(e(104),e(3)),l=Object(n.a)(i,r,[],!1,null,null,null);l.options.__file="src/admin/pages/works.vue";a.default=l.exports},72:function(t,a,e){"use strict";var r=e(73),o=e.n(r),s=localStorage.getItem("token");o.a.defaults.baseURL="https://webdev-api.loftschool.com",o.a.defaults.headers.Authorization="Bearer ".concat(s),o.a.interceptors.response.use((function(t){return t}),(function(t){var a=t.config;return t.response&&401===t.response.status?o.a.post("/refreshToken").then((function(t){var e=t.data.token;return localStorage.setItem("token",e),o.a.defaults.headers.Authorization="Bearer ".concat(e),a.headers.Authorization="Bearer ".concat(e),o()(a)})):Promise.reject(t)})),a.a=o.a},74:function(t,a,e){}}]);